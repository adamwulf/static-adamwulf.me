<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
	<head>
		<script src="/examples/bajax/jquery.js" type="text/javascript"></script>
		<script src="/examples/bajax/bajax.js" type="text/javascript"></script>
		<script type="text/javascript">
			
			/**
			 * keep track of how many
			 * requests are in the queue
			 * waiting to be sent
			 */
			var qcount = 0;

			/**
			 * set up default options for
			 * the AJAX calls
			 */
			var bAjaxOptions = {
				url : "ajax.php",
				type : "POST",
				dataType : "json",
				success : function(data, q_len){
					qcount = q_len;
					$("#queue").text("Requests in Queue: " + (qcount));
					if(q_len == 0){
						refresh();
					}
				}
			};
						
			/**
			 * send a no-op command to the server
			 * to retrive the latest count
			 */
			function refresh(){
				$.bAjax(bAjaxOptions, {
					data : { func : "refresh" },
					success : function(data){
						$("#theNumber").text("The Number: " + data);
					}
				});
			}
			
			/**
			 * Increase the counter
			 */
			function goUp(){
				$.bAjax(bAjaxOptions, {
					data : { func : "up" },
					success : function(data){
						$("#theNumber").text("The Number: " + data);
					}
				});
				$("#queue").text("Requests in Queue: " + (++qcount));
			}
			
			/**
			 * Decrease the counter
			 */
			function goDown(){
				$.bAjax(bAjaxOptions, {
					data : { func : "down" },
					success : function(data){
						$("#theNumber").text("The Number: " + data);
					}
				});
				$("#queue").text("Requests in Queue: " + (++qcount));
			}
			
			/**
			 * listen for clicks on up and down links
			 */
			$(function(){
				$("#up").click( goUp );
				$("#down").click( goDown );
			});
						
			/**
			 * begin the AJAX loop
			 */
			refresh();
		</script>
	</head>
	<body>
		<h3 id="theNumber">
			The Number: Loading...
		</h3>
		<h3 id="queue">
			Requests in Queue: 0
		</h3>
		<p>
			<a id="up" href="javascript:;">Increase "The Number"</a>
		</p>
		<p>
			<a id="down" href="javascript:;">Decrease "The Number"</a>
		</p>
		<div id="console">
			<br><br>
			Clicking either link will fire off an AJAX request to increase or decrease a global counter. 
			The counter is shared by all users, and will update in real time as its changed by anyone.
			<br><br>
			The server is set up with a 1/2 second lag, and your requests are queued until the server
			has finished processing your last request.
		</div>
	</body>
</html>
