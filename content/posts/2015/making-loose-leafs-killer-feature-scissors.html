+++
title = "The Making of Loose Leaf’s Killer Feature: Scissors"
date = "2015-01-27T10:25:32+0000"
slug = "making-loose-leafs-killer-feature-scissors"
type = "post"
+++

<p>I easily spent the most time during development on the scissors tool, which might be surprising given how simple it is to use. You can see a quick example below. Just like real scissors, you can easily slice your pictures into any shape.</p>
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-video"><video controls="" loop="" muted="" src="/wp-content/uploads/2015/01/1169431231373393920.mp4"></video></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow"></div>
</div>
<p>It seems simple enough right, so what makes this so tough? The next example shows just how robust the scissors are. For a dramatically bizarre shape, they still cut it into pieces just as you’d expect, and quickly at that. And it even supports cutting holes into scraps too.</p>
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-video"><video controls="" loop="" muted="" src="/wp-content/uploads/2015/01/1169436929159249920.mp4"></video></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-video"><video controls="" loop="" muted="" src="/wp-content/uploads/2015/01/1170531829967659008.mp4"></video></figure>
</div>
</div>
<p>We’re getting closer to seeing why this is so tough: it’s cutting arbitrary shapes with an arbitrary path into an arbitrary number of sub-shapes or holes, and doing this quickly enough on a relatively small mobile processor.</p>
<h2 class="wp-block-heading"><a aria-hidden="true" class="aal_anchor" href="#first-the-model" id="first-the-model"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>First: The Model</h2>
<p>Before we can dive into how the slice happens, we have to understand how the data is modeled.</p>
<p>Each scrap is at least is a closed (looped) outer Bézier path with potentially many inner paths. Each of those Bézier paths is actually made up of many segments, each of which is a single cubic Bézier curve. Following along these path elements shows up the direction of that path. The enclosed subpaths are always in the reverse direction of the outer shape path.</p>
<p>You can see an arbitrary shape here, along with its numbered segments and path direction. Next to it is a simple 3 segment scissor cut.</p>
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image is-resized"><img alt="numbered-shape" class="wp-image-4756" decoding="async" fetchpriority="high" height="300" sizes="(max-width: 300px) 100vw, 300px" src="/files/2015/01/numbered-shape-300x300.png" srcset="/wp-content/uploads/2015/01/numbered-shape-300x300.png 300w, /wp-content/uploads/2015/01/numbered-shape-150x150.png 150w, /wp-content/uploads/2015/01/numbered-shape.png 600w" style="width:363px;height:auto" width="300"/></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image is-resized"><img alt="numbered-scissors" class="wp-image-4755" decoding="async" height="300" sizes="(max-width: 300px) 100vw, 300px" src="/files/2015/01/numbered-scissors-300x300.png" srcset="/wp-content/uploads/2015/01/numbered-scissors-300x300.png 300w, /wp-content/uploads/2015/01/numbered-scissors-150x150.png 150w, /wp-content/uploads/2015/01/numbered-scissors.png 600w" style="width:370px;height:auto" width="300"/></figure>
</div>
</div>
<p>With only these two paths, we can determine how to cut the original shape into its smaller pieces.</p>
<h2 class="wp-block-heading"><a aria-hidden="true" class="aal_anchor" href="#second-the-algorithm" id="second-the-algorithm"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Second: The Algorithm</h2>
<p>In the picture above, it’s obvious to us humans where the new scraps would be, but for a computer to calculate the new shapes, it has to detect where the shape’s path and the scissor’s path intersect. This gives us the key pieces that show which segments of the scissor’s line will be edges of new subshapes, and which pieces we can safely ignore.</p>
<p>Once we find these intersection points, we can throw away all pieces of the scissors that aren’t inside of the shape. Next we compile a list of all segments of the shape, their direction, and the intersecting segments of the scissors, and their direction. The scissors’ segments are special, and we duplicate these, one for each direction.</p>
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image is-resized"><img alt="intersections" class="wp-image-4759" decoding="async" height="300" sizes="(max-width: 300px) 100vw, 300px" src="/files/2015/01/intersections-300x300.png" srcset="/wp-content/uploads/2015/01/intersections-300x300.png 300w, /wp-content/uploads/2015/01/intersections-150x150.png 150w, /wp-content/uploads/2015/01/intersections.png 600w" style="width:406px;height:auto" width="300"/></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image is-resized"><img alt="path-with-direction-2" class="wp-image-4766" decoding="async" height="300" loading="lazy" sizes="auto, (max-width: 300px) 100vw, 300px" src="/files/2015/01/path-with-direction-2-300x300.png" srcset="/wp-content/uploads/2015/01/path-with-direction-2-300x300.png 300w, /wp-content/uploads/2015/01/path-with-direction-2-150x150.png 150w, /wp-content/uploads/2015/01/path-with-direction-2.png 600w" style="width:416px;height:auto" width="300"/></figure>
</div>
</div>
<p>After all of this path processing, we’re finally ready to calculate the paths of our new sliced shape!</p>
<p>Now we follow these simple rules:</p>
<ol class="wp-block-list">
<li>each of the shape’s segments can be used only once</li>
<li>pick any of the scissor segments of either direction</li>
<li>follow it along its direction to the next intersection</li>
<li>follow the arrows, turning left at each intersection, until you reach the original segment again</li>
<li>continue until you run out of segments to use</li>
</ol>
<h2 class="wp-block-heading"><a aria-hidden="true" class="aal_anchor" href="#third-the-output" id="third-the-output"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Third: The Output</h2>
<p>Tracing along the edges in this way, and you’ll easily compile up a list of the new shapes.</p>
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-video"><video controls="" loop="" src="/wp-content/uploads/2015/01/1171632527358705664.mp4"></video></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-video"><video controls="" loop="" src="/wp-content/uploads/2015/01/1171219578219847680.mp4"></video></figure>
</div>
</div>
<h2 class="wp-block-heading"><a aria-hidden="true" class="aal_anchor" href="#fourth-debugging" id="fourth-debugging"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Fourth: Debugging</h2>
<p>The real difficulty of this process came from a number of reasons:</p>
<ol class="wp-block-list">
<li>The UIBezierPath class for iOS is extremely lacking, especially <a href="http://stackoverflow.com/questions/6600558/making-uibezierpath-more-like-nsbezierpath-with-elementcount-and-elementatindex">when compared to NSBeizerPath</a> in OS X</li>
<li>There are no built in methods to find intersection points or splitting of Bezier paths or curves</li>
<li>By default, accessing any element of a UIBezierPath requires looping through the entire path, making most any algorithm performance terrible</li>
</ol>
<p>All of that means that I needed to write <em>lots</em> of Bezier specific code, which generally means <em>lots</em> of bugs too.</p>
<p>I used unit tests to verify as much of my code as I could, but it was very had to catch every edge case – especially when the scissors and shape would be at tangents. To help find these edge cases, I also write a small iOS app that’d let me draw any shape and then cut it with any scissor path. This let me try new shapes and cuts extremely quickly – I even gave the app to my 5yo daughter and asked her to try and break it.</p>
<p>Anytime the app threw an exception or otherwise had a problem – it would email me the paths of the shape and scissors for me to debug and add to my unit tests. In this way, I slowly built up a library of unit tests as I worked toward a robust solution.</p>
<h2 class="wp-block-heading"><a aria-hidden="true" class="aal_anchor" href="#fifth-references" id="fifth-references"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Fifth: References</h2>
<p>For anyone looking to write code for Bezier paths, I highly suggest the following reading and resources:</p>
<ol class="wp-block-list">
<li>A Primer on Bézier Curves – <a href="http://pomax.github.io/bezierinfo/">http://pomax.github.io/bezierinfo/</a></li>
<li>KevinLinDev Geometry Tutorial – <a href="http://www.kevlindev.com/gui/math/polynomial/">http://www.kevlindev.com/gui/math/polynomial/</a></li>
<li>DrawKit – <a href="http://apptree.net/drawkit.htm">http://apptree.net/drawkit.htm</a></li>
</ol>