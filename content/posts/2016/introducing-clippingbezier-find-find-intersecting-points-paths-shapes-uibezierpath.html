+++
title = "Introducing ClippingBezier: Find find intersecting points, paths, and shapes from UIBezierPath"
date = "2016-12-23T14:51:14+0000"
slug = "introducing-clippingbezier-find-find-intersecting-points-paths-shapes-uibezierpath"
type = "post"
+++

<p>UIBezierPath’s an an incredibly powerful tool for modeling complex paths and shapes in Objective-C and Swift, but it’s surprisingly difficult to perform operations on two or more paths. Applications like <a href="https://www.paintcodeapp.com/">PaintCode</a> make it easy to get the difference or intersection between two paths, but there are limited options for doing this on demand in code. This is particularly meaningful in drawing apps like <a href="http://getlooseleaf.com/">Loose Leaf</a>, where all of the paths are generated by the user.</p>
<p>Loose Leaf is unique – when the user draws on an imported image, the ink actually sticks to that image. This is done by splitting the UIBezierPath of the user’s pen with the UIBezierPath border of each scrap on the page.</p>
<p><video autoplay="" height="300" loop="1" muted="" src="//getlooseleaf.com/all-vines/videos/1175944481913118720.mp4" width="300"></video></p>
<p>All of this magic is packaged into the new <a href="https://github.com/adamwulf/ClippingBezier">ClippingBezier framework</a> for iOS.</p>
<h2><a aria-hidden="true" class="aal_anchor" href="#example-find-intersecting-points-between-two-paths" id="example-find-intersecting-points-between-two-paths"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Example: Find intersecting points between two paths</h2>
<p>Let’s start with a simple example: finding the exact points that two paths intersect. Below we have two paths, a circle and a square:</p>
<figure data-orig-height="225" data-orig-width="225"><img alt="circle-and-square" class="alignnone size-full wp-image-5088" decoding="async" fetchpriority="high" height="225" sizes="(max-width: 225px) 100vw, 225px" src="/files/2016/12/circle-and-square.png" srcset="/wp-content/uploads/2016/12/circle-and-square.png 225w, /wp-content/uploads/2016/12/circle-and-square-150x150.png 150w" width="225"/></figure>
<p>The following code give us an array of intersection points, that we can iterate over and mark on our canvas:</p>
<pre><code>NSArray* intersections = [square findIntersectionsWithClosedPath:circle andBeginsInside:nil];
for (DKUIBezierPathIntersectionPoint* intersection in intersections) {
     CGPoint p = intersection.location1;
     [[UIColor redColor] setFill];
     [[UIBezierPath bezierPathWithArcCenter:p radius:7 startAngle:0 endAngle:2*M_PI clockwise:YES] fill];
}</code></pre>
<p>And now we can mark precisely where these two arbitrary paths intersect.</p>
<figure data-orig-height="225" data-orig-width="225"><img alt="circle-and-square-intersections" class="alignnone size-full wp-image-5089" decoding="async" height="225" sizes="(max-width: 225px) 100vw, 225px" src="/files/2016/12/circle-and-square-intersections.png" srcset="/wp-content/uploads/2016/12/circle-and-square-intersections.png 225w, /wp-content/uploads/2016/12/circle-and-square-intersections-150x150.png 150w" width="225"/></figure>
<h2><a aria-hidden="true" class="aal_anchor" href="#example-find-overlap-between-two-paths" id="example-find-overlap-between-two-paths"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Example: Find overlap between two paths</h2>
<p>Let’s take the above example to the next step: what part of the circle’s path is actually inside of the square, and can we split it apart from the circle itself?</p>
<p>ClippingBezier makes it easy to find these intersections. To make the outputs visual even in code, the paths labeled (in name only) with colors. The blue path defines the clipping path, and the red and green paths are the clipped paths, either inside or outside the blue clipping path respectively</p>
<figure data-orig-height="225" data-orig-width="225"><img alt="circle-square-intersect" class="alignnone size-full wp-image-5090" decoding="async" height="225" sizes="(max-width: 225px) 100vw, 225px" src="/files/2016/12/circle-square-intersect.png" srcset="/wp-content/uploads/2016/12/circle-square-intersect.png 225w, /wp-content/uploads/2016/12/circle-square-intersect-150x150.png 150w" width="225"/></figure>
<p>To calculate the above paths, we can use the following code in ClippingBezier:</p>
<pre><code>NSArray* redGreenAndBlueSegments = [UIBezierPath redAndGreenAndBlueSegmentsCreatedFrom:square bySlicingWithPath:circle andNumberOfBlueShellSegments:NULL];
NSMutableArray* redSegments = [redGreenAndBlueSegments objectAtIndex:0];
NSMutableArray* greenSegments = [redGreenAndBlueSegments objectAtIndex:1];
NSMutableArray* blueSegments = [redGreenAndBlueSegments objectAtIndex:2];

void(^drawSegmentsWithColor)(NSArray*,UIColor*) = ^(NSArray&lt;DKUIBezierPathClippedSegment*&gt;* segments,UIColor* color){
	for (DKUIBezierPathClippedSegment* segment in segments) {
		[color setStroke];
		[[segment pathSegment] setLineWidth:2];
		[[segment pathSegment] stroke];
	}
};

drawSegmentsWithColor(redSegments, [UIColor redColor]);
drawSegmentsWithColor(greenSegments, [UIColor greenColor]);
drawSegmentsWithColor(blueSegments, [UIColor blueColor]);
</code></pre>
<p>And that’s it! now we have physically split the circle curve into separate UIBezierPath’s representing the portions inside and outside the square.</p>
<h2><a aria-hidden="true" class="aal_anchor" href="#example-find-shapes-cut-from-the-intersection-of-two-paths" id="example-find-shapes-cut-from-the-intersection-of-two-paths"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Example: Find shapes cut from the intersection of two paths</h2>
<p>ClippingBezier can also calculate the sub-shapes generated from the intersecting and overlapping paths. I wrote about the algorithm that ClippingBeizer uses in my <a href="http://blog.getlooseleaf.com/post/109315792079/the-making-of-loose-leafs-killer-feature">post about Loose Leaf’s scissors tool</a>. Now you can build that same feature into your own apps.</p>
<p>With a single line, we can ask ClippingBezier to calculate the sub-shapes generated from the shape and scissors paths.</p>
<pre><code>NSArray* shapes = [square uniqueShapesCreatedFromSlicingWithUnclosedPath:circle];
for (DKUIBezierPathShape* shape in shapes) {
	[[UIColor randomColor] setFill];
	[shape.fullPath fill];
}
[[UIColor greenColor] setStroke];
[circle stroke];
</code></pre>
<p>and now we can iterate over these new sub-shapes and fill them each with a <a href="https://gist.github.com/r3econ/9772706">random color</a>.</p>
<figure data-orig-height="225" data-orig-width="225"><img alt="circle-and-square-subshapes" class="alignnone size-full wp-image-5091" decoding="async" height="225" loading="lazy" sizes="auto, (max-width: 225px) 100vw, 225px" src="/files/2016/12/circle-and-square-subshapes.png" srcset="/wp-content/uploads/2016/12/circle-and-square-subshapes.png 225w, /wp-content/uploads/2016/12/circle-and-square-subshapes-150x150.png 150w" width="225"/></figure>
<h2><a aria-hidden="true" class="aal_anchor" href="#example-cutting-paths-with-holes" id="example-cutting-paths-with-holes"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Example: Cutting Paths with Holes</h2>
<p>ClippingBezier also handles UIBezierPaths that contain subpaths – essentially holes in their shapes. The following example shows the same circle path slicing the square with a smaller square hole:</p>
<pre><code>UIBezierPath* square = [UIBezierPath bezierPathWithRect:CGRectMake(200, 200, 200, 200)];
[square appendPath:[[UIBezierPath bezierPathWithRect:CGRectMake(230, 230, 140, 140)] bezierPathByReversingPath]];
</code></pre>
<p>With the above square path, the generated sub-shapes now show:</p>
<figure data-orig-height="225" data-orig-width="225"><img alt="circle-and-square-with-hole" class="alignnone size-full wp-image-5092" decoding="async" height="225" loading="lazy" sizes="auto, (max-width: 225px) 100vw, 225px" src="/files/2016/12/circle-and-square-with-hole.png" srcset="/wp-content/uploads/2016/12/circle-and-square-with-hole.png 225w, /wp-content/uploads/2016/12/circle-and-square-with-hole-150x150.png 150w" width="225"/></figure>
<h2><a aria-hidden="true" class="aal_anchor" href="#working-with-complex-shapes" id="working-with-complex-shapes"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Working with Complex Shapes</h2>
<p>ClippingBezier isn’t limited to simple shapes like squares and circles. These simpler shapes make for easy to understand examples, but ClippingBezier was designed to work with any complex Bezier path. Check out the intersections and sub-shapes found by intersecting a complex path with its own mirror</p>
<figure class="tmblr-full" data-orig-height="331" data-orig-width="476"><img alt="complex-subshapes" class="alignnone size-full wp-image-5093" decoding="async" height="331" loading="lazy" sizes="auto, (max-width: 476px) 100vw, 476px" src="/files/2016/12/complex-subshapes.png" srcset="/wp-content/uploads/2016/12/complex-subshapes.png 476w, /wp-content/uploads/2016/12/complex-subshapes-300x209.png 300w" width="476"/></figure>
<h2><a aria-hidden="true" class="aal_anchor" href="#get-the-code" id="get-the-code"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Get the code</h2>
<p><a href="https://github.com/adamwulf/ClippingBezier">ClippingBezier is available on Github</a> under the MIT license.</p>
<h2><a aria-hidden="true" class="aal_anchor" href="#thanks-for-your-support" id="thanks-for-your-support"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Thanks for your support!</h2>
<p>Support the project and <a href="https://itunes.apple.com/us/app/loose-leaf/id625659452?mt=8&amp;uo=4&amp;at=10lNUI&amp;ct=blog">download Loose Leaf</a> from the App Store. Thanks!</p>