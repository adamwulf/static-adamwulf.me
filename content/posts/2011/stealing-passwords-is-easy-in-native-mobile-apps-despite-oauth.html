+++
title = "Stealing Passwords is Easy in Native Mobile Apps Despite OAuth"
date = "2011-01-12T10:30:19+0000"
slug = "stealing-passwords-is-easy-in-native-mobile-apps-despite-oauth"
type = "post"
+++

<h3><a aria-hidden="true" class="aal_anchor" href="#preface" id="preface"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Preface</h3>
<p><img align="right" alt="" class="alignright size-full wp-image-2081" decoding="async" height="78" src="/files/2011/01/oauth-broken.png" title="oauth broken" width="180"/><a href="http://oauth.net/">OAuth</a> is a fantastic login protocol that allows disparate web applications to all use the same login provider. However, I’ve discovered that its use in native mobile applications is borderline dangerous, and in this post I’ll describe why.</p>
<p>Last year I released <a href="http://herefilefile.com/">my first (and still only) iPhone application</a>. Even though my app doesn’t use OAuth, the then recent <a href="http://arstechnica.com/security/guides/2010/09/twitter-a-case-study-on-how-to-do-oauth-wrong.ars">Twitter/OAuth fiasco</a> stoked my interested in mobile OAuth. I was particularly curious how OAuth providers protected their passwords in their mobile SDKs.</p>
<p>I downloaded the Facebook SDK and poked around in the iPhone simulator, and frankly I didn’t like what I saw. In less than an afternoon, I was able to build an app that could steal a user’s password as they logged in through Facebook Connect, all 100% transparent to the user, 100% transparent to Facebook, and 100% transparent to Apple. In a word, this is not a good sign for OAuth and native mobile apps. To be clear, <strong>this affects every single OAuth provider and mobile platform, not just Facebook and iOS.</strong></p>
<p>Despite numerous web searches, emails, and even code submission to Facebook, I haven’t seen anyone talk about this problem on the web at all. Seeing as how the Facebook Connect SDK is <a href="http://developers.facebook.com/blog/post/213">almost 2 years old</a>, and <a href="http://blog.twitter.com/2010/08/twitter-applications-and-oauth.html">many</a> <a href="http://developer.yahoo.com/oauth/">other</a> <a href="http://wiki.developer.myspace.com/index.php?title=OAuth_Overview">companies</a> <a href="http://about.digg.com/blog/twitter-anywhere-openid-oauth-and-diggs-support-open-standards">are following</a> <a href="http://www.readwriteweb.com/archives/ready_for_gmail_mashups_google_adds_oauth_to_imap.php">suit</a> with OAuth in native mobile SDKs, I think this conversation is long overdue.</p>
<p>In this post, I’m going to explain how and why <strong>OAuth in native mobile apps does not secure your password</strong>, and why you should still be wary when logging into Facebook/Twitter/Google/anything through any app except their respective official native mobile apps. I’m writing this post to expose the still weak security for single sign on services in native mobile apps. I am not providing any source code, though after reading this post I’m sure you’ll agree that eavesdropping on an OAuth transaction in a native mobile app is extremely easy even for a novice programmer.</p>
<h3><a aria-hidden="true" class="aal_anchor" href="#the-problem" id="the-problem"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>The Problem</h3>
<p>The purpose of Oauth is to let application developers use Twitter/Facebook/anysite’s login mechanism, all while keeping the password 100% secret from the application developer. In this world, if the application turns out to be an untrusted malicious application, all the user needs to do is turn off access from that application on Twitter/Facebook/anysite’s settings page.</p>
<p>However, <strong>native mobile application developers are still able to access (steal) your password even when using OAuth for login</strong>, all 100% undetected. This means that for native mobile apps, using OAuth is not any more secure than using <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic Auth</a>, and <a href="http://blog.twitter.com/2010/08/twitter-applications-and-oauth.html">Twitter’s API change from Basic Auth to OAuth</a> does nothing to protect user’s passwords from malicious application developers.</p>
<p>To be clear, this affects every OAuth implementation in native mobile apps, across iOS, Android, and [I believe] Windows 7.</p>
<h3><a aria-hidden="true" class="aal_anchor" href="#when-your-password-is-safe-web-apps" id="when-your-password-is-safe-web-apps"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>When your password <em>is</em> safe: Web Apps</h3>
<p><a href="/files/2011/01/oauth-web-app.png"><img align="right" alt="" class="alignright size-full wp-image-2082" decoding="async" fetchpriority="high" height="300" sizes="(max-width: 400px) 100vw, 400px" src="/files/2011/01/oauth-web-app.png" srcset="/wp-content/uploads/2011/01/oauth-web-app.png 400w, /wp-content/uploads/2011/01/oauth-web-app-300x225.png 300w" title="oauth web app" width="400"/></a>As our first example, let’s take a look at web apps – this is true for both mobile web apps and desktop web apps.</p>
<p>OAuth succeeds in protecting the user’s login information because the web browser is a 100% trusted agent and ensures that the application code on the web app’s domain name cannot access any information on the OAuth providers domain name. This is called <a href="http://en.wikipedia.org/wiki/Same_origin_policy">Same Origin Policy</a>.</p>
<p>For example, when [insert malicious web app here] begins an OAuth login, the browser opens a window/redirects/iframes to the authentication provider (probably Facebook, Twitter, Google, etc). Due to the browser’s security, it is impossible for the malicious app to eavesdrop as the user types in their password. After the user enters their username + password into the legitimate login screen, approves (or disapproves) the web app from accessing it’s account, and is then redirected back to the potentially malicious web app.</p>
<p>At no point in this transaction does the malicious web app have access to the user’s login credentials. Browser security prevents any scripts on the malicious site from interfering/listening to/intercepting the login credentials. It’s this trusted and neutral 3rd party browser that makes this negotiation possible. The phone’s built in browser acts as the trusted middleman during the OAuth transaction.</p>
<p>Once the user discovers the malicious apps evil plot, all the user needs to do is login to the OAuth provider’s trusted site and remove the malicious app from their trusted apps. done.</p>
<p>You’re safe, the world is happy, and OAuth saves the day. Not so in native mobile apps, let’s take a look:</p>
<h3><a aria-hidden="true" class="aal_anchor" href="#when-your-password-is-not-safe-native-mobile-apps" id="when-your-password-is-not-safe-native-mobile-apps"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>When your password <em>is not</em> safe: Native Mobile Apps</h3>
<p><a href="/files/2011/01/oauth-native-mobile.png"><img align="right" alt="" class="alignright size-full wp-image-2083" decoding="async" height="300" sizes="(max-width: 400px) 100vw, 400px" src="/files/2011/01/oauth-native-mobile.png" srcset="/wp-content/uploads/2011/01/oauth-native-mobile.png 400w, /wp-content/uploads/2011/01/oauth-native-mobile-300x225.png 300w" title="oauth native mobile" width="400"/></a>In native mobile apps, the mobile application itself takes the place of the browser, so there is no longer a trusted neutral 3rd party browser to act as the trusted middle man in OAuth transactions – the mobile app itself acts as both the OAuth client and the OAuth middle man!</p>
<p>So what does this mean? It means any native mobile app implementing OAuth can steal your login credentials, completely transparent to you the user, the OAuth provider, and even the phone manufacturer/carrier.</p>
<p>Since the mobile app hosts a tiny instance of the web browser inside of itself, that app can see/do/act on anything inside the web content it shows – no exceptions. This means the Same Origin Policy we discussed above is now out the window. Even though the native app uses WebKit to do the rendering/browsing, that native app can also do absolutely anything to any webpage loaded inside of it, including stealing passwords, without the loaded website even knowing.</p>
<p>I’m not going to show any code, but I’ve verified in code that this is in fact possible. I’ve effectively stolen my own Facebook password using <a href="https://github.com/facebook/facebook-ios-sdk">Facebook’s provided iOS OAuth library</a>. It only took minor modifications using entirely publicly available APIs in iOS. The exact same attack could be used in any app that logins with Twitter, and is not specific to iOS – this affects Android (and presumably Windows 7 though I haven’t looked at their API).</p>
<p><strong>How the attack works:</strong></p>
<ol>
<li>Malicious attacker builds native mobile app and uses any publicly available OAuth SDK from Facebook/Twitter/anyone</li>
<li>The attacker loads the legitimate OAuth login screen using a web view available from the phone’s public SDK</li>
<li>The attacker runs JavaScript on that webview object, attaching JavaScript event handlers to any &lt;input&gt; element on the page</li>
<li>When the value of an &lt;input&gt; changes, the injected JavaScript notifies the wrapping native application about the change</li>
<li>User authenticates, and OAuth transaction is completed as normal – except the malicious app has been listening to every keystroke! Password: compromised!</li>
<li><a href="http://macapper.com/2010/08/01/android-hack-clarification-and-update/">Malicious app uploads credentials to anonymous server in China</a></li>
</ol>
<p>Since the attacker is (a) using publicly available APIs to (b) inject JavaScript on the authentication page (even if the page is over SSL), the malicious app developer is able to listen as the user types in their credentials. The OAuth provider has zero visibility that this attack is going on; there is no way to mitigate it from the provider side. Even a walled garden app store wouldn’t be able to weed out malicious apps based on (a) static analysis of code or (b) watching for malicious network traffic.</p>
<p><strong>This is all because the embedded browser in native applications cannot be the trusted middleman in the OAuth handshake.</strong></p>
<h3><a aria-hidden="true" class="aal_anchor" href="#mobile-web-1-mobile-native-0" id="mobile-web-1-mobile-native-0"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Mobile Web: 1, Mobile Native: 0</h3>
<p>Currently, the only secure way for OAuth to exist in mobile is for mobile <em>web</em> applications. These applications still run in a trusted 3rd party browser that prevents cross domain script execution. Since mobile native apps fill the role of OAuth client <em>and</em> trusted browser, the user’s login credentials are not secure.</p>
<p>It should be noted that <a href="http://www.oauth.net/">OAuth’s website</a> makes no mention of using OAuth for native mobile apps, but clearly mobile app developers are still using it to solve the elusive secure authentication problem.</p>
<p><strong>Again, this affects 100% of OAuth implementations in native mobile applications, regardless of OAuth provider or mobile platform.</strong></p>
<h3><a aria-hidden="true" class="aal_anchor" href="#solutions" id="solutions"><svg aria-hidden="true" class="aal_svg" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Solutions?</h3>
<p>For a long time, Twitter provided only basic auth for it’s API, but its more recent OAuth API isn’t actually any more secure. I believe that the only way to allow secure OAuth within native mobile apps is to have a more strict web browser API for native app developers, and to properly notify OAuth providers when their service is being accessed from an insecure mobile browser. Unfortunately the safest solution right now: don’t use OAuth.</p>
<p>I’m not sure what the correct long term solution is for login in native mobile apps, but OAuth currently falls very short. Mobile still has a long way to go to keep users passwords <a href="https://www.zdnet.com/article/spyphone-app-harvests-personal-data-from-stock-iphones/">and data</a> safe.</p>